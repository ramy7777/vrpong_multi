<!DOCTYPE html>
<html>
<head>
    <title>Pong Master VR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A WebXR Pong game for Meta Quest">
    <!-- Import Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; 
            background: linear-gradient(135deg, #000033 0%, #000 100%);
            color: white; 
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
        }
        
        canvas { display: block; }
        
        .game-title {
            position: absolute;
            top: 40px;
            left: 0;
            right: 0;
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 64px;
            color: white;
            text-shadow: 0 0 10px #4d69ff, 0 0 20px rgba(77, 105, 255, 0.5);
            letter-spacing: 2px;
            z-index: 100;
        }
        
        .game-subtitle {
            position: absolute;
            top: 160px;
            left: 0;
            right: 0;
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 400;
            font-size: 18px;
            color: #b3e5fc;
            letter-spacing: 4px;
            text-transform: uppercase;
            z-index: 100;
        }
        
        .game-buttons {
            position: absolute;
            top: 230px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 30px;
            z-index: 100;
        }
        
        .btn {
            padding: 15px 35px;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: all 0.5s ease;
        }
        
        .btn:hover:before {
            left: 100%;
        }
        
        .btn:active {
            transform: translateY(3px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        #startVR {
            background: linear-gradient(to right, #4CAF50, #388E3C);
        }
        
        #startVR:hover {
            background: linear-gradient(to right, #66BB6A, #43A047);
        }
        
        #startDesktop {
            background: linear-gradient(to right, #2196F3, #1976D2);
        }
        
        #startDesktop:hover {
            background: linear-gradient(to right, #42A5F5, #1E88E5);
        }
        
        #fallbackDesktop {
            background: linear-gradient(to right, #2196F3, #1976D2);
            padding: 15px 35px;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: all 0.3s ease;
            margin-top: 30px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        #fallbackDesktop:hover {
            background: linear-gradient(to right, #42A5F5, #1E88E5);
        }
        
        #fallbackDesktop:active {
            transform: translateY(3px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        #noVR {
            display: none;
            position: absolute;
            top: 65%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            padding: 10px;
            border-radius: 8px;
        }
        
        #errorMessage {
            display: none;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: white;
            background: rgba(229, 57, 53, 0.8);
            padding: 15px 30px;
            border-radius: 8px;
            font-family: 'Roboto', sans-serif;
            max-width: 80%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        #loadingMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            font-family: 'Orbitron', sans-serif;
            text-align: center;
            letter-spacing: 2px;
        }
        
        /* Canvas background overlay for depth */
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, transparent 10%, rgba(0, 0, 0, 0.5) 100%);
            pointer-events: none;
            z-index: 1;
        }
    </style>
    <!-- Include Socket.IO client library from CDN -->
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <!-- Import simple-peer as a global variable -->
    <script>
        // Load SimplePeer script
        function loadSimplePeer() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/simple-peer@9.11.1/simplepeer.min.js';
                script.onload = () => {
                    console.log('SimplePeer library loaded successfully');
                    resolve();
                };
                script.onerror = () => {
                    console.error('Failed to load SimplePeer library');
                    reject(new Error('Failed to load SimplePeer library'));
                };
                document.head.appendChild(script);
            });
        }
        
        // Load the script when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadSimplePeer().catch(err => {
                console.error('Error loading SimplePeer:', err);
            });
        });
    </script>
</head>
<body>
    <!-- Background overlay for depth -->
    <div class="background-overlay"></div>
    
    <!-- Game title and subtitle -->
    <h1 class="game-title">PONG MASTER VR</h1>
    <div class="game-subtitle">Experience the classic game in virtual reality</div>
    
    <div class="game-buttons">
        <button id="startVR" class="btn">Enter VR Mode</button>
        <button id="startDesktop" class="btn">Play in Browser</button>
    </div>
    
    <div id="noVR">
        <button id="fallbackDesktop">Play in Desktop Mode</button>
    </div>
    
    <div id="errorMessage"></div>
    <div id="loadingMessage">Loading game assets...</div>
    
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/",
            "socket.io-client": "https://cdn.socket.io/4.6.0/socket.io.esm.min.js"
        }
    }
    </script>
    <script type="module">
        import { Game } from './js/game/Game.js';
        let game;
        
        // Error handling
        window.addEventListener('error', function(event) {
            const errorMsg = document.getElementById('errorMessage');
            errorMsg.textContent = `Error: ${event.message}`;
            errorMsg.style.display = 'block';
            console.error('Game error:', event.error);
        });

        document.addEventListener('DOMContentLoaded', () => {
            const loadingMsg = document.getElementById('loadingMessage');
            const startVRBtn = document.getElementById('startVR');
            const startDesktopBtn = document.getElementById('startDesktop');
            const fallbackDesktopBtn = document.getElementById('fallbackDesktop');
            
            // Add loading animation
            let dots = 0;
            const loadingInterval = setInterval(() => {
                dots = (dots + 1) % 4;
                loadingMsg.textContent = `Loading game assets${'.'.repeat(dots)}`;
            }, 500);
            
            // Function to start the game
            const startGame = (vrMode = false) => {
                try {
                    // Hide buttons, show loading
                    document.querySelector('.game-buttons').style.display = 'none';
                    document.querySelector('.game-title').style.display = 'none';
                    document.querySelector('.game-subtitle').style.display = 'none';
                    loadingMsg.style.display = 'block';
                    
                    // Initialize the game
                    game = new Game();
                    
                    loadingMsg.style.display = 'none';
                    clearInterval(loadingInterval);
                } catch (error) {
                    loadingMsg.style.display = 'none';
                    clearInterval(loadingInterval);
                    const errorMsg = document.getElementById('errorMessage');
                    errorMsg.textContent = `Failed to initialize game: ${error.message}`;
                    errorMsg.style.display = 'block';
                    console.error('Game initialization error:', error);
                }
            };
            
            // Check if WebXR is available
            if ('xr' in navigator) {
                navigator.xr.isSessionSupported('immersive-vr').then(supported => {
                    if (!supported) {
                        startVRBtn.style.display = 'none';
                        document.getElementById('noVR').style.display = 'block';
                    }
                });
            } else {
                startVRBtn.style.display = 'none';
                document.getElementById('noVR').style.display = 'block';
            }
            
            // Event listeners for buttons
            startVRBtn.addEventListener('click', () => {
                startGame(true);
            });
            
            startDesktopBtn.addEventListener('click', () => {
                startGame(false);
            });
            
            fallbackDesktopBtn.addEventListener('click', () => {
                document.getElementById('noVR').style.display = 'none';
                startGame(false);
            });
        });
    </script>
</body>
</html>
